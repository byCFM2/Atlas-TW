-- Tower_of_Karazhan.lua - Данные предметов из Башни Каражан
-- Модульная структура данных для Atlas-TW

local _G = getfenv()
AtlasTW = _G.AtlasTW or {}
local L = AtlasTW.Local
local BZ = AceLibrary("Babble-Zone-2.2a")
local BB = AceLibrary("Babble-Boss-2.2a")
AtlasTW.InstanceData = AtlasTW.InstanceData or {}

local ephemeralPendant = {
    {id=55482, dropRate=7, disc = L["Neck"], container={47275,47233,47239,47311,47317,47323,47395,47401,47407,47065,47071,47077,
    47329,47185,47191,47197,47113,47119}},
}
-- Данные Башни Каражан
AtlasTW.InstanceData.TowerofKarazhan = {
    Name = BZ["Tower of Karazhan"],
    Location = BZ["Deadwind Pass"],
    Level = 60,
    Acronym = "KARA40",
    Attunement = true,
    MaxPlayers = 40,
    DamageType = L["Shadow"],L["Fire"],L["Arcane"],
    Keys = {
        { name = L["Upper Karazhan Tower Key"], loot = "VanillaKeys", info = L["Quests"] },
    },
    Entrances = {
        { letter = "A".." "..L["Entrance"] },
        { letter = "B".." "..L["Connection"] }
    },
    Bosses = {
        {
            id = "KeeperGnarlmoon",
            prefix = "1)",
            name = BB["Keeper Gnarlmoon"],
            defaults = { dropRate = 25 },
            loot = {
                {id=55078},
                {id=55084},
                {id=55081},
                {id=55285},
                {id=55079},
                {id=55083},
                {},
                {id=55080},
                {},
                {id=55082},
                {},
                {id=41485, dropRate=3.25, disc = L["Reagent"]},
            }
        },
        {
            id = "LeyWatcherIncantagos",
            prefix = "2)",
            name = BB["Ley-Watcher Incantagos"],
            defaults = { dropRate = 25 },
            loot = {
                {id=55086},
                {id=55099},
                {id=55089},
                {id=55507},
                {id=55085},
                {},
                {id=55087},
                {id=55091},
                {},
                {id=55090},
                {},
                {},
                {},
                {},
                {},
                {id=41403, dropRate=100, container={55133,55134,55135}},
                {},
                {id=41485, dropRate=3.25, disc = L["Reagent"]},
                {id=41373, disc = L["Quest Item"], dropRate=100},
            }
        },
        {
            id = "Anomalus",
            prefix = "3)",
            name = BB["Anomalus"],
            defaults = { dropRate = 25 },
            loot = {
                {id=55097},
                {id=55106},
                {id=55098},
                {id=55092},
                {id=55095},
                {},
                {id=55093},
                {},
                {id=55096},
                {id=55279},
                {},
                {id=41485, dropRate=3.25, disc = L["Reagent"]},
                {id=41412, dropRate=100},
            }
        },
        {
            id = "EchoofMedivh",
            prefix = "4)",
            name = BB["Echo of Medivh"],
            defaults = { dropRate = 25 },
            loot = {
                {id=55112},
                {id=55108},
                {id=55109},
                {id=55107},
                {},
                {id=55111},
                {id=55110},
                {id=55094},
                {},
                {id=55276},
                {},
                {id=41485, dropRate=3.25, disc = L["Reagent"]},
                {id=41414, dropRate=100},
            }
        },
        {
            id = "King",
            prefix = "5)",
            name = BB["King"] .. " (Chess fight)",
            defaults = { dropRate = 12.5 },
            loot = {
                {id=55088},
                {id=55102},
                {id=55104},
                {id=55105},
                {id=55274},
                {},
                {id=55101},
                {id=55103},
                {},
                {id=55100},
                {},
                {},
                {},
                {},
                {id=20739, dropRate=3},
                {id=55483, dropRate=50, container={47232,47238,47310,47316,47274,47394,47400,47406}},
                {id=55484, dropRate=50, container={47064,47070,47076,47322,47328,47184,47190,47196,47112,47118}},
                {},
                {id=41485, dropRate=100, disc = L["Reagent"]},
                unpack(ephemeralPendant),
            }
        },
        {
            id = "SanvTasdal",
            prefix = "6)",
            name = BB["Sanv Tas'dal"],
            defaults = { dropRate = 14.3 },
            loot = {
                {id=55113},
                {id=55117},
                {id=55118},
                {id=55119},
                {},
                {id=55114},
                {},
                {id=55115},
                {id=55116},
                {},
                {},
                {},
                {},
                {},
                {},
                {id=55485, dropRate=50, container={47229,47235,47307,47313,47271,47391,47397,47403}},
                {id=55486, dropRate=50, container={47061,47067,47073,47319,47325,47181,47187,47193,47109,47115}},
                {},
                {id=41485, dropRate=100, disc = L["Reagent"]},
                unpack(ephemeralPendant),
            }
        },
        {
            id = "RupturanTheBroken",
            prefix = "7)",
            name = BB["Rupturan the Broken"],
            defaults = { dropRate = 14.3 },
            loot = {
                {id=55122},
                {id=55125},
                {id=55126},
                {},
                {id=55123},
                {id=55124},
                {},
                {id=55120},
                {id=55121},
                {},
                {},
                {},
                {},
                {},
                {},
                {id=55487, dropRate=50, container={47228,47234,47306,47312,47270,47390,47396,47402}},
                {id=55488, dropRate=50, container={47060,47066,47072,47318,47324,47180,47186,47192,47108,47114}},
                {},
                {id=41485, dropRate=100, disc = L["Reagent"]},
                unpack(ephemeralPendant),
            }
        },
        {
            id = "Kruul",
            prefix = "8)",
            name = BB["Kruul"],
            defaults = { dropRate = 11.1 },
            loot = {
                {id=55132},
                {id=55130},
                {id=55506},
                {},
                {id=55131},
                {},
                {id=55511},
                {id=55127},
                {id=55129},
                {id=55128},
                {id=55510},
                {},
                {},
                {},
                {},
                {id=55489, dropRate=50, container={47273,47231,47237,47309,47315,47393,47399,47405}},
                {id=55490, dropRate=50, container={47063,47069,47075,47321,47327,47183,47189,47195,47111,47117}},
                {},
                {id=41485, dropRate=100, disc = L["Reagent"]},
                unpack(ephemeralPendant),
            }
        },
        {
            id = "Mephistroth",
            prefix = "9)",
            name = BB["Mephistroth"],
            defaults = { dropRate = 19 },
            loot = {
                {id=55351},
                {id=55356},
                {id=55513},
                {id=55357, dropRate=8},
                {id=55352},
                {id=55354},
                {id=55355},
                {id=55512},
                {},
                {id=55346, dropRate=8},
                {id=55347, dropRate=8},
                {id=55348},
                {id=55349},
                {id=55350},
                {},
                {id=55353},
                {},
                {id=55579, dropRate=100, container={55515,55516,55517}},
                {},
                unpack(ephemeralPendant),
                {},
                {id=55491, dropRate=50, container={47230,47236,47308,47314,47272,47392,47398,47404}},
                {id=55492, dropRate=50, container={47062,47068,47074,47320,47326,47182,47188,47194,47110,47116}},
                {},
                {id=41485, dropRate=100, disc = L["Reagent"]},
                {id=41447, dropRate=100},
                {},
                {id=92082, dropRate=5},
            }
        },
        {
            id = "K40Trash",
            name = L["Trash Mobs"].."-"..BZ["Tower of Karazhan"],
            defaults = { dropRate = .25 },
            loot = {
                {id=55278},
                {id=55280},
                {id=55281},
                {id=55282},
                {id=55283},
                {id=55284},
                {},
                {id=55286},
                {id=55508},
                {id=55275},
                {},
                {id=55277},
            }
        },
        { name = L["Tower of Karazhan Sets"], items = "AtlasLootUKSetMenu" },
    }
}

-- Инициализация предметов для всех боссов
for _, bossData in ipairs(AtlasTW.InstanceData.TowerofKarazhan.Bosses) do
    bossData.items = bossData.items or AtlasTW.CreateItemsFromLootTable(bossData)
    bossData.loot = nil -- Очищаем временные данные
end